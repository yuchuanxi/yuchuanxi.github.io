{"version":3,"sources":["exportExcel.js","App.js","reportWebVitals.js","index.js"],"names":["loadImgs","urls","proList","i","pro","Promise","resolve","img","Image","crossOrigin","src","onload","push","length","all","then","rs","getBase64Img","a","imgs","width","height","naturalWidth","naturalHeight","canvas","document","createElement","ctx","getContext","left","j","drawImage","toDataURL","imgNum","writeFile","fileName","content","blob","Blob","type","download","href","URL","createObjectURL","click","jsonToTableRows","json","data","Array","isArray","list","alert","map","row","date","createTIme","split","splice","userName","username","userId","join","category","responsible","comment","followup","addHeaderToSheet","sheet","headers","columns","item","header","title","key","dataIndex","parseInt","addRowsToSheet","workbook","rows","addRows","getRow","eachCell","cell","rowNumber","getColumn","alignment","vertical","horizontal","wrapText","imgCol","cells","cellNum","colWidth","value","imgInfo","imgId1","addImage","base64","extension","tl","col","ext","jsonToExcel","tableRows","Excel","Workbook","creator","lastModifiedBy","created","Date","modified","detailSheet","addWorksheet","views","state","ySplit","exportExcel","excelTitle","xlsx","writeBuffer","buffer","App","useState","setJson","setTitle","className","placeholder","style","onChange","e","target","preventDefault","htmlFor","id","onClick","tableData","JSON","parse","display","cursor","padding","margin","border","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.75e9ba7c.chunk.js","sourcesContent":["import Excel from \"exceljs\";\n\nfunction loadImgs(urls) {\n  let proList = []\n\n  for (let i = 0; i < urls.length; i++) {\n    const pro = new Promise(resolve => {\n      let img = new Image();\n      img.crossOrigin = '*'\n      img.src = urls[i]\n      img.onload = () => {\n        resolve(img)\n      }\n    })\n\n    proList.push(pro)\n  }\n\n  return Promise.all(proList).then((rs) => {\n    // console.log('finish all', urls)\n    return Promise.resolve(rs)\n  })\n}\n\nasync function getBase64Img(urls) {\n  const imgs = await loadImgs(urls)\n  // console.log(imgs)\n\n  let width = 0, height = 0\n  for (let i = 0; i < imgs.length; i++) {\n    const img = imgs[i];\n    // console.log(img)\n    width += (img.naturalWidth / 2 + 10)\n    if (height < img.naturalHeight / 2)  height = img.naturalHeight / 2\n  }\n  const canvas = document.createElement('canvas')\n  canvas.width = width + 10\n  canvas.height = height + 20\n  const ctx = canvas.getContext('2d')\n  let left = 10\n  for (let j = 0; j < imgs.length; j++) {\n    const img = imgs[j];\n\n    ctx.drawImage(img, left, 10, img.naturalWidth / 2, img.naturalHeight / 2)\n    left += (img.naturalWidth / 2 + 10)\n  }\n\n  return ({\n    img: canvas.toDataURL('image/jpeg'),\n    width: width / (height / 133),\n    imgNum: imgs.length\n  })\n}\n\n// 将二进制转为Excel并下载\nconst writeFile = (fileName, content) => {\n  let a = document.createElement(\"a\");\n  let blob = new Blob([content], { type: \"text/plain\" });\n\n  a.download = fileName;\n  a.href = URL.createObjectURL(blob);\n\n  a.click();\n};\n\n// 生成表头\nconst tableColumns = () => {\n  return [\n    { 'dataIndex': 'userName', 'key': 'userName', 'title': '用户昵称', width: 128},\n    { 'dataIndex': 'userId', 'key': 'userId', 'title': '用户ID', width: 100},\n    { 'dataIndex': 'date', 'key': 'date', 'title': '反馈日期', width: 100},\n    { 'dataIndex': 'category', 'key': 'category', 'title': '反馈类型', width: 80},\n    { 'dataIndex': 'content', 'key': 'content', 'title': '反馈内容', width: 288},\n    { 'dataIndex': 'img', 'key': 'img', 'title': '图片', width: 500},\n    { 'dataIndex': 'responsible', 'key': 'responsible', 'title': '复核方', width: 88},\n    { 'dataIndex': 'comment', 'key': 'comment', 'title': '备注', width: 288},\n    { 'dataIndex': 'followup', 'key': 'followup', 'title': '周一跟进情况', width: 288},\n  ]\n}\n// 原始数据转化为行数据\nconst jsonToTableRows = (json) => {\n  // {\n  //   \"code\": 0,\n  //   \"msg\": \"成功\",\n  //   \"nowTime\": 1638780275,\n  //   \"data\": {\n  //     \"list\": []\n  //   }\n  // }\n\n  // {\n  //   \"id\": 27119,\n  //   \"userId\": 4685084,\n  //   \"username\": \"小哥\",\n  //   \"category\": \"体验问题\",\n  //   \"content\": \"银行卡认证好多天了都无法解决 提现无法完成\",\n  //   \"img\": [\n  //     \"https://cdn.weipaitang.com/sky/h5/wentifk/image/20211205/1cc4c747c6824e5fb7620525952795b5-W828H1472\"\n  //   ],\n  //   \"state\": 1,\n  //   \"stateText\": \"未标记\",\n  //   \"origin\": \"用户提交\",\n  //   \"operatorName\": \"\",\n  //   \"createTIme\": \"2021-12-05 18:47:11\",\n  //   \"remark\": \"\",\n  //   \"replyNumber\": 0,\n  //   \"replyStateText\": \"未回复\",\n  //   \"label_msg\": \"\",\n  //   \"label_ids\": \"\",\n  //   \"ua_cVersion\": \"4.8.1\",\n  //   \"ua_phoneName\": \"iPhone8Plus\",\n  //   \"ua_client\": \"APP\"\n  // }\n  if (!(json && json.data && Array.isArray(json.data.list))) { // 数据格式校验\n    alert('数据格式有问题！')\n  }\n\n\n  const list  = json.data.list;\n  const rows = list.map(row => {\n    let date = row.createTIme.split(' ')[0].split('-')\n    date.splice(1, 0, '年')\n    date.splice(3, 0, '月')\n    date.splice(5, 0, '日')\n\n    return ({\n      userName: row.username,\n      userId: row.userId,\n      date: date.join(''),\n      category: row.category,\n      content: row.content,\n      img: row.img,\n      responsible: '',\n      comment: '',\n      followup: ''\n    })\n  })\n\n  return rows;\n}\n\n// 给指定表添加表头\nconst addHeaderToSheet = (sheet, headers) => {\n  let columns = []; // 表头\n  // 表头格式化\n  headers.map((item) => {\n    columns.push({\n      header: item.title,\n      key: item.key || item.dataIndex,\n      width: parseInt(item.width / 6, 10) || 80,\n    });\n    return true;\n  });\n  // 添加表头\n  sheet.columns = columns;\n}\n\n// 给指定标添加数据\nconst addRowsToSheet = async (workbook, sheet, rows) => {\n  sheet.addRows(rows);\n  // 设置每一列样式 居中\n  const row = sheet.getRow(1);\n  row.eachCell((cell, rowNumber) => {\n    sheet.getColumn(rowNumber).alignment = {\n      vertical: \"middle\",\n      horizontal: \"center\",\n    };\n  });\n\n\n  const contentCol = sheet.getColumn('content')\n  contentCol.eachCell((cell, rowNumber) => {\n    if (rowNumber === 1) return;\n    cell.alignment = {\n      wrapText: true,\n      horizontal: 'left',\n      vertical: \"middle\"\n     }\n  })\n  const imgCol = sheet.getColumn('img')\n\n  // 遍历此图片列中的所有当前单元格\n  const cells = []\n  imgCol.eachCell(async function(cell, rowNumber) {\n    cells.push(cell)\n  });\n  const cellNum = cells.length\n  let colWidth = 0\n  for (let i = 0; i < cellNum; i++) {\n    const cell = cells[i];\n    if (!(typeof cell.value === 'object' && cell.value.length > 0)) {\n      if (cell.row !== 1) cell.value = ''\n      continue\n    }\n    const row = sheet.getRow(cell.row);\n    row.height = 110\n\n    // 存在图片链接的继续\n    const imgInfo = await getBase64Img(cell.value)\n    if (colWidth < imgInfo.width) colWidth = imgInfo.width + 50\n    // console.log(imgInfo)\n    const imgId1 = workbook.addImage({\n      base64: imgInfo.img,\n      extension: 'jpeg',\n    });\n    // console.log(imgId1)\n    sheet.addImage(imgId1, {\n      tl: { col: cell.col - 1, row: cell.row - 1 },\n      // br: { col: cell.col, row: cell.row + 1 },\n      ext: {width: imgInfo.width, height: 133}\n    });\n\n    cell.value = ''\n  }\n  imgCol.width = colWidth / 6\n}\n\nconst jsonToExcel = async (columns, tableRows) => {\n  // 初始化 创建工作簿\n  const workbook = new Excel.Workbook();\n  // 设置工作簿属性\n  workbook.creator = \"汪飞\";\n  workbook.lastModifiedBy = \"汪飞\";\n  workbook.created = new Date();\n  workbook.modified = new Date();\n\n  // 添加工作表\n  let detailSheet = workbook.addWorksheet('明细', {views:[{state: 'frozen', ySplit:1}]});\n\n  // 添加表头\n  addHeaderToSheet(detailSheet, columns);\n\n  // 添加表格数据\n  await addRowsToSheet(workbook, detailSheet, tableRows);\n\n  return workbook;\n}\n// 执行下载表格\nconst exportExcel = async (json, excelTitle) => {\n  const columns = tableColumns(json)\n  const tableRows = jsonToTableRows(json)\n  const workbook = await jsonToExcel(columns, tableRows)\n  // console.log(workbook)\n  // 将表格数据转为二进制\n  workbook.xlsx.writeBuffer().then((buffer) => {\n    writeFile(`${excelTitle}.xlsx`, buffer);\n  });\n};\n\nexport default exportExcel\n","import React, { useState, useEffect } from \"react\";\n// import Excel from \"exceljs\";\nimport exportExcel from \"./exportExcel\";\n\nimport './App.css';\n\nimport TableDownload from \"./TableDownload\";\n\nfunction App() {\n  const [json, setJson] = useState('')\n  const [title, setTitle] = useState('功能反馈表')\n\n  const handleChange = (e) => {\n    setJson(e.target.value)\n    e.preventDefault()\n  }\n  const handleTitleChange = (e) => {\n    setTitle(e.target.value)\n    e.preventDefault()\n  }\n\n  const handleClick = () => {\n    // console.log('json', json)\n    if (!json) {\n      alert('请输入数据')\n      return\n    }\n    const tableData = JSON.parse(json)\n    exportExcel(tableData, title)\n  }\n\n  return (\n    <div className=\"App\">\n      <textarea placeholder=\"请输入需要转成excel的数据\" style={{width: \"100%\", height: 300}}  onChange={handleChange} />\n      <p>\n      <label htmlFor=\"fname\">表名：</label>\n        <input id=\"fname\" style={{width: 200, height: 32}} placeholder={title}  onChange={handleTitleChange} />\n      </p>\n      <div onClick={handleClick} style={{ display:\"inline-block\", cursor: \"pointer\", padding: '10px 30px', margin: 10, border: \"1px solid red\" }}>导出 Excel</div>\n      {/* <TableDownload text=\"导出Excel\" excelTitle=\"表格数据\" /> */}\n    </div>\n  )\n}\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}